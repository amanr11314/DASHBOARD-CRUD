<html lang="en">
  <head>
    <title>PHP and jQuery - Crop Image and Upload using Croppie plugin</title>
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
      integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://use.fontawesome.com/releases/v5.3.1/css/all.css"
      integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/croppie/2.6.2/croppie.min.css"
    />
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script> -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/croppie/2.6.2/croppie.js"></script>

    <meta name="csrf-token" content="{{ csrf_token() }}" />
  </head>

  <body>
    <div class="container">
      <div class="card" style="max-height: 500px">
        <div class="card-header bg-info">
          PHP and jQuery - Crop Image and Upload using Croppie plugin
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-4 text-center">
              <div id="upload-demo"></div>
            </div>
            <div class="col-md-4" style="padding: 5%">
              <strong>Select image to crop:</strong>
              <input type="file" id="image" />

              <button
                class="btn btn-success btn-block btn-upload-image"
                style="margin-top: 2%"
              >
                Upload Image
              </button>
            </div>

            <div class="col-md-4">
              <div
                id="preview-crop-image"
                style="
                  background: #9d9d9d;
                  width: 300px;
                  padding: 50px 50px;
                  height: 300px;
                "
              ></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Button trigger modal -->
    <button
      type="button"
      class="btn btn-primary"
      data-toggle="modal"
      data-target="#exampleModal"
    >
      Launch demo modal
    </button>

    <!-- Modal -->
    <div
      class="modal fade"
      id="exampleModal"
      tabindex="-1"
      role="dialog"
      aria-labelledby="exampleModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
            <button
              type="button"
              class="close"
              data-dismiss="modal"
              aria-label="Close"
            >
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">...</div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-dismiss="modal"
            >
              Close
            </button>
            <button type="button" class="btn btn-primary">Save changes</button>
          </div>
        </div>
      </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script
      src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
      integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
      integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
      crossorigin="anonymous"
    ></script>

    <script type="text/javascript">
      var resize = $("#upload-demo").croppie({
        enableExif: true,
        enableOrientation: true,
        viewport: {
          // Default { width: 100, height: 100, type: 'square' }
          width: 200,
          height: 200,
          type: "circle", //square
        },
        boundary: {
          width: 300,
          height: 300,
        },
      });

      $("#image").on("change", function () {
        var reader = new FileReader();
        reader.onload = function (e) {
          resize
            .croppie("bind", {
              url: e.target.result,
            })
            .then(function () {
              console.log("jQuery bind complete");
            });
        };
        file = this.files[0];

        //for showing in modal
        reader.readAsDataURL(file);
        image = new Image();
        $("#image").attr("src", _URL.createObjectURL(file));
        $(image).ready(function ($) {
          $("#modal").modal("show");
        });
        window.URL.revokeObjectURL(image.src);
      });

      $(".btn-upload-image").on("click", function (ev) {
        resize
          .croppie("result", {
            type: "canvas",
            size: "viewport",
          })
          .then(function (img) {
            $.ajax({
              url: "croppie.php",
              type: "POST",
              data: {
                image: img,
              },
              success: function (data) {
                html = '<img src="' + img + '" />';
                $("#preview-crop-image").html(html);
              },
            });
          });
      });
    </script>
  </body>
</html>
